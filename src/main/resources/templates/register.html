<!--resources/templates/register-->
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>회원 가입</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
<h2>회원 가입</h2>
<form id="registerForm" enctype="multipart/form-data">
  <div>
    <label for="name">이름:</label>
    <input type="text" id="name" name="name" required>
  </div>
  <div>
    <label for="phoneNumber">전화번호:</label>
    <input type="text" id="phoneNumber" name="phoneNumber" required>
  </div>
  <div>
    <label for="encryptionCode">비밀번호:</label>
    <input type="password" id="encryptionCode" name="encryptionCode" required>
  </div>
  <div>
    <label for="confirmPassword">비밀번호 확인:</label>
    <input type="password" id="confirmPassword" name="confirmPassword" required>
  </div>
  <div>
    <label for="dateOfBirth">생년월일:</label>
    <input type="date" id="dateOfBirth" name="dateOfBirth" required>
  </div>
  <div>
    <label for="gender">성별:</label>
    <select id="gender" name="gender" required>
      <option value="여성">여성</option>
      <option value="남성">남성</option>
      <option value="기타">기타</option>
    </select>
  </div>
  <div>
    <label for="userType">사용자 타입:</label>
    <select id="userType" name="userType" required>
      <option value="개인">개인</option>
      <option value="사업자">사업자</option>
    </select>
  </div>
  <div>
    <label for="loginType">로그인 타입:</label>
    <select id="loginType" name="loginType" required>
      <option value="쇼셜">쇼셜</option>
      <option value="카카오">카카오</option>
    </select>
  </div>
  <div>
    <label for="job">직업:</label>
    <input type="text" id="job" name="job" required>
  </div>
  <div>
    <label for="region">지역:</label>
    <input type="text" id="region" name="region" required>
  </div>
  <div>
    <label for="category">카테고리:</label>
    <input type="text" id="category" name="category" required>
  </div>
  <div>
    <label for="file">이미지 업로드</label>
    <input type="file" id="file" name="file">
  </div>
  <div>
    <button type="button" id="submitBtn">회원 가입</button>
  </div>
</form>

<div id="errorMessage" style="color: red;"></div>

<script type="text/javascript">
$(document).ready(function () {
    $('#submitBtn').on('click', function () {
        var userDto = {
            name: $('#name').val(),
            phoneNumber: $('#phoneNumber').val(),
            encryptionCode: $('#encryptionCode').val(),
            confirmPassword: $('#confirmPassword').val(),
            dateOfBirth: $('#dateOfBirth').val(),
            gender: $('#gender').val(),
            userType: $('#userType').val(),
            loginType: $('#loginType').val(),
            job: $('#job').val(),
            region: $('#region').val(),
            category: $('#category').val()
        };

        var formData = new FormData();
        formData.append('userDto', JSON.stringify(userDto));
        formData.append('file', $('#file')[0].files[0]);

        $.ajax({
            type: 'POST',
            url: '/api/users/join',
            data: formData,
            contentType: false,
            processData: false,
            success: function (response) {
                alert('회원가입 성공');
                window.location.href = '/login';
            },
            error: function (error) {
                console.log(error);
                $('#errorMessage').text('회원가입 실패: ' + error.responseText);
            }
        });
    });
});
</script>
</body>
</html>
